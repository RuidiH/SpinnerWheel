# 幸运转盘抽奖系统

一个支持实时更新的网页转盘抽奖应用，具备管理员配置和用户抽奖功能。

## 系统要求

- Windows 10/11 操作系统
- 无需安装其他依赖（生产环境）
- 开发环境需要：Go 1.21+ 和 Node.js 18+

## 快速开始

### 生产环境部署

1. **下载程序**
   - 获取编译好的 `spinner-wheel.exe` 文件
   - 双击运行即可启动服务

2. **访问系统**
   - 用户抽奖界面：http://localhost:8080/user
   - 管理员配置界面：http://localhost:8080/admin

3. **数据文件**
   - 程序会自动创建 `data/` 目录
   - 配置文件：`data/config.json`
   - 历史记录：`data/history.json`

### 开发环境搭建

1. **克隆代码仓库**
```bash
git clone [repository-url]
cd SpinnerWheel
```

2. **安装后端依赖**
```bash
go mod init spinner-wheel
go mod tidy
```

3. **安装前端依赖**
```bash
cd frontend
npm install
```

4. **开发模式运行**
```bash
# 终端1: 启动后端
go run .

# 终端2: 启动前端开发服务器
cd frontend
npm start
```

### 生产环境构建

**推荐方式（使用脚本）：**
```bash
# Windows 系统
build.bat

# 或手动执行以下步骤
```

**手动构建步骤：**
1. **构建前端**
```bash
cd frontend
npm run build
cd ..
```

2. **复制前端文件**
```bash
# 创建静态目录
mkdir static
# 复制构建文件
xcopy /E /Y frontend\build\* static\
```

3. **构建后端**
```bash
go build -o spinner-wheel.exe
```

4. **运行**
```bash
./spinner-wheel.exe
```

## 使用说明

### 管理员操作

1. **访问管理界面**：http://localhost:8080/admin

2. **游戏模式配置**
   - **模式1**：自定义奖品，每个奖品可设置中奖概率
   - **模式2**：固定模式，5%中奖率（"没中奖" vs "中奖了!"）

3. **基本设置**
   - 设置当前玩家编号
   - 设置总抽奖次数
   - 保存配置或重置游戏

4. **实时更新**
   - 所有配置更改会立即同步到用户界面
   - 如果正在抽奖，更新会在抽奖结束后生效

### 用户操作

1. **访问抽奖界面**：http://localhost:8080/user

2. **进行抽奖**
   - 点击转盘开始抽奖
   - 转盘会旋转3-4秒后停止
   - 系统会语音播报中奖结果

3. **查看信息**
   - 当前玩家编号
   - 剩余抽奖次数
   - 最近2天的抽奖历史

## 概率算法说明

### 模式1 - 加权概率算法
使用累积分布函数（CDF）实现精确的概率控制：

1. **概率累积**：将所有奖品概率累加构建累积数组
   ```
   奖品概率: [10%, 15%, 20%, 30%, 25%]
   累积数组: [10, 25, 45, 75, 100]
   ```

2. **随机选择**：生成0-100的随机数，查找对应区间
   ```
   随机数30 → 落在区间(25, 45] → 选中第3个奖品
   ```

3. **精确保证**：严格按照设定概率分配中奖机会，支持小数点精度

### 模式2 - 固定概率算法
简单的5%中奖率实现：

```go
if rand.Float64() < 0.05 {  // 5%概率
    return "中奖了!"
} else {                     // 95%概率  
    return "没中奖"
}
```

在任意12个区段中随机选择显示位置，但结果始终维持5%中奖率。

### 安全性保证
- ✅ **服务端计算**：所有概率计算在后端执行，前端无法篡改
- ✅ **时间戳种子**：使用纳秒级时间戳作为随机种子，确保真正随机
- ✅ **防作弊设计**：结果由服务器决定后发送给客户端，客户端仅负责动画展示
- ✅ **数据完整性**：历史记录与实际中奖结果完全一致

## 配置文件说明

### config.json 结构
```json
{
  "mode": 1,
  "mode1_options": [
    {"text": "奖品1", "probability": 8.33},
    {"text": "奖品2", "probability": 8.33}
  ],
  "current_player": 1,
  "remaining_spins": 100,
  "total_spins": 0
}
```

### 字段说明
- `mode`: 游戏模式（1或2）
- `mode1_options`: 模式1的奖品配置
- `current_player`: 当前玩家编号
- `remaining_spins`: 剩余抽奖次数
- `total_spins`: 总抽奖次数统计

## 端口配置

默认端口：8080

修改端口：
```bash
./spinner-wheel.exe -port 9000
```

## 故障排除

### 常见问题

1. **程序启动后立即闪退/崩溃**
   - **问题原因**：缺少必要文件导致模板加载失败
   - **解决方案**：
     ```bash
     # 确保运行完整构建流程
     build.bat
     
     # 或确保以下文件/目录存在：
     # - static/ 目录（React构建文件）
     # - templates/ 目录（开发模式HTML模板）
     ```
   - **验证方法**：运行 `run.bat` 应显示启动信息而不是闪退

2. **无法启动程序（端口占用）**
   - 检查端口8080是否被占用
   - 尝试使用不同端口启动：`spinner-wheel.exe -port 9000`

3. **无法访问网页**
   - 确认程序正在运行（应显示"服务器启动在端口 8080"）
   - 检查防火墙设置
   - 尝试 http://127.0.0.1:8080

4. **显示开发模式界面**
   - **现象**：看到简化的HTML页面而非完整转盘界面
   - **原因**：`static/` 目录不存在或为空
   - **解决**：运行 `build.bat` 重新构建前端

5. **配置丢失**
   - 检查 `data/` 目录权限
   - 确保程序有写入权限

6. **转盘不旋转**
   - 检查浏览器控制台错误
   - 确认 WebSocket 连接正常
   - 刷新页面重试

### 数据备份

重要数据位于 `data/` 目录：
- 定期备份 `config.json`（游戏配置）
- 定期备份 `history.json`（抽奖历史）

### 日志查看

程序运行时会在控制台输出日志信息，包括：
- API 请求记录
- WebSocket 连接状态
- 错误信息

## 技术架构

- **后端**：Go + Gin 框架
- **前端**：React + TypeScript
- **通信**：WebSocket 实时更新
- **存储**：JSON 文件
- **部署**：单一可执行文件

## 浏览器兼容性

支持以下浏览器最新版本：
- Chrome
- Firefox
- Safari
- Edge

## 联系支持

如遇问题，请检查：
1. 程序运行日志
2. 浏览器控制台错误
3. 网络连接状态

---

© 2024 幸运转盘抽奖系统